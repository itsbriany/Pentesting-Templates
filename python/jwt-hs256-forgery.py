import argparse
import jwt
import json
from pathlib import Path

def load_secret(secret):
    with Path(secret).open('r') as fp:
        return fp.read()

def load_message(message):
    with Path(message).open('r') as fp:
        return json.loads(fp.read())

def forge_jwt(args):
    message = load_message(args.message)
    secret = load_secret(args.secret)
    return jwt.encode(message, secret, algorithm='HS256')

def run(args):
    jwt = forge_jwt(args)
    print(f'[+] Here is your JWT: {jwt.decode("utf-8")}')

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Forge JWT HS256 signatures with a secret.')
    parser.add_argument('--secret', dest='secret', type=str, help='the secret used as the secret to sign the token', required=True)
    parser.add_argument('--message', dest='message', type=str, help='the message for the JWT token', required=True)

    try:
        args = parser.parse_args()
        run(args)
    except argparse.ArgumentError as e:
        print("[!] {}".format(e))
        parser.print_usage()
        sys.exit(1)
